{"id":"e42b56b3-f8c1-494a-aaa6-3130256aa7ca","name":"test","scenario_trigger":"test","description":"","active":true,"updated":"2019-05-30T09:53:28.0840000Z","userDisplayName":"Rudra Modi","code":"{\"version\":3,\"steps\":[{\"id\":\"d934b8ed1292-9e9363791b37768a-5d81\",\"type\":\"yesnoprompt\",\"dataType\":\"boolean\",\"designer\":{\"xLocation\":20,\"yLocation\":20,\"next\":\"95e59d37fe82-d02260ba817b040b-607b\"},\"text\":\"Hello doc, do you want to check on your patients today?\",\"variable\":\"isdoctor\",\"stringId\":\"stringId_469082091e3f6044\",\"targetStepId\":\"7f52a0fa3003-390d4e4e3cf1a146-eda8\"},{\"id\":\"7f52a0fa3003-390d4e4e3cf1a146-eda8\",\"type\":\"datasource\",\"designer\":{\"xLocation\":250,\"yLocation\":27,\"next\":\"16da3436c954-2332c368fa3531cf-2c38\",\"errorStepId\":\"95e59d37fe82-d02260ba817b040b-607b\"},\"dataConnection\":\"\",\"authenticationProvider\":\"CDM Endpoint\",\"urlBase\":\"'https://healthacceleratordit.api.crm.dynamics.com/api/data/v9.1/'\",\"urlPath\":\"'WhoAmI'\",\"urlParams\":\"\",\"method\":\"get\",\"headers\":\"\",\"opJson\":true,\"opResolveWithFullResponse\":false,\"response\":\"response\",\"error\":\"err\"},{\"id\":\"95e59d37fe82-d02260ba817b040b-607b\",\"type\":\"statement\",\"designer\":{\"xLocation\":27,\"yLocation\":320},\"text\":\"fail\",\"visible\":\"${response}\",\"stringId\":\"stringId_e11185b6e35c1b76\"},{\"id\":\"16da3436c954-2332c368fa3531cf-2c38\",\"type\":\"statement\",\"designer\":{\"xLocation\":400,\"yLocation\":71,\"next\":\"94a2c5200c20-2150f23bae4efad3-4e42\"},\"text\":\"Tracing you in our systems, please wait..\",\"stringId\":\"stringId_b3f5b7aa972e4b9f\",\"visible\":\"${response}.UserId\"},{\"id\":\"94a2c5200c20-2150f23bae4efad3-4e42\",\"type\":\"datasource\",\"designer\":{\"xLocation\":440,\"yLocation\":112,\"errorStepId\":\"95e59d37fe82-d02260ba817b040b-607b\",\"next\":\"f01b98aa4470-c29c77759b3b84ec-b194\"},\"dataConnection\":\"\",\"authenticationProvider\":\"CDM Endpoint\",\"urlBase\":\"'https://healthacceleratordit.api.crm.dynamics.com/api/data/v9.1/'\",\"urlPath\":\"'systemusers('+'77632cda-ef0e-e911-a95d-000d3a59705a'+')'\",\"urlParams\":\"\",\"method\":\"get\",\"headers\":\"\",\"opJson\":true,\"opResolveWithFullResponse\":false,\"response\":\"response2\",\"error\":\"error2\"},{\"id\":\"f01b98aa4470-c29c77759b3b84ec-b194\",\"type\":\"statement\",\"designer\":{\"xLocation\":508,\"yLocation\":160,\"next\":\"f69691bad428-db84259f9c4d0dfe-1044\"},\"text\":\"\\\"Hello \\\" + ${response2}.fullname\",\"stringId\":\"stringId_860c8cf14f66ca98\"},{\"id\":\"90e834f8a8fa-6e947164bd449f9b-590b\",\"type\":\"datasource\",\"designer\":{\"xLocation\":600,\"yLocation\":286,\"errorStepId\":\"95e59d37fe82-d02260ba817b040b-607b\",\"next\":\"5200c49063bc-ad0ab73d3acbd17a-1ed0\"},\"dataConnection\":\"\",\"authenticationProvider\":\"CDM Endpoint\",\"urlBase\":\"${GetDocContactQueryString}\",\"urlPath\":\"\",\"urlParams\":\"\",\"method\":\"get\",\"headers\":\"\",\"opJson\":true,\"opResolveWithFullResponse\":false,\"response\":\"response3\",\"error\":\"error3\"},{\"id\":\"f69691bad428-db84259f9c4d0dfe-1044\",\"type\":\"action\",\"label\":\"Action\",\"designer\":{\"xLocation\":580,\"yLocation\":212,\"next\":\"90e834f8a8fa-6e947164bd449f9b-590b\"},\"onInit\":\"/*\\n * Use the following variable notation:\\n * \\n * ${var} = scenario local variables\\n * &{var} = user data variables\\n * @{var} = global conversation variables\\n * \\n * Available object to use in the code:\\n * require, session, moment, builder, next(), setTimeout, underscore\\n * \\n * Hit 'Ctrl + Space' for autocomplete\\n * \\n * Example: ${welcomeMessage} = \\\"Hello \\\" + ${name}\\n*/\\n\\n//Frame CDS API calls \\n\\n//Get contact record that has the same emailadress as that of the user accessing CDM\\n ${GetDocContactQueryString} = \\n\\\"https://healthacceleratordit.api.crm.dynamics.com/api/data/v9.1/contacts?$select=fullname&$top=1&$filter=emailaddress1 eq \\\" + \\\"%27\\\"+${response2}.domainname+\\\"%27\\\";\\n\\n\"},{\"id\":\"3fb7fe22a3d5-710bb7869f677a9c-a8a3\",\"type\":\"datasource\",\"designer\":{\"xLocation\":693,\"yLocation\":410,\"errorStepId\":\"95e59d37fe82-d02260ba817b040b-607b\",\"next\":\"03429abb20db-ded90b271c97b015-e2c5\"},\"dataConnection\":\"\",\"authenticationProvider\":\"CDM Endpoint\",\"urlBase\":\"${GetRelatedContactsQueryString}\",\"urlPath\":\"\",\"urlParams\":\"\",\"method\":\"get\",\"headers\":\"\",\"opJson\":true,\"opResolveWithFullResponse\":false,\"response\":\"response4\",\"error\":\"error4\"},{\"id\":\"5200c49063bc-ad0ab73d3acbd17a-1ed0\",\"type\":\"action\",\"label\":\"Action\",\"designer\":{\"xLocation\":646,\"yLocation\":340,\"next\":\"3fb7fe22a3d5-710bb7869f677a9c-a8a3\"},\"onInit\":\"/*\\n * Use the following variable notation:\\n * \\n * ${var} = scenario local variables\\n * &{var} = user data variables\\n * @{var} = global conversation variables\\n * \\n * Available object to use in the code:\\n * require, session, moment, builder, next(), setTimeout, underscore\\n * \\n * Hit 'Ctrl + Space' for autocomplete\\n * \\n * Example: ${welcomeMessage} = \\\"Hello \\\" + ${name}\\n*/\\n\\n//Get related patients for the above contact\\n${GetRelatedContactsQueryString} =\\n\\\"https://healthacceleratordit.api.crm.dynamics.com/api/data/v9.1/contacts?$select=fullname,telephone1,entityimage&$top=5&$filter=_msemr_generalpractioner_value eq \\\" +${response3}.value[0].contactid;\\n\\n\"},{\"id\":\"03429abb20db-ded90b271c97b015-e2c5\",\"type\":\"statement\",\"designer\":{\"xLocation\":217,\"yLocation\":416},\"text\":\"Here are your patients. Which one do you want to check on?\",\"layout\":\"vertical\",\"attachment\":[{\"type\":\"Carousel\",\"carouselCode\":\"(function(){\\n    var patients = [];\\n    for (var i =0 ; i < ${response4}.value.length; i++) {\\n        patients.push(new builder.ThumbnailCard().title(${response4}.value[i].fullname).\\n        images([builder.CardImage.create(session,${response4}.value[i].entityimage)]).\\n        buttons([\\n            builder.CardAction.postBack(session,'schedule','Schedule an appointment'),\\n            builder.CardAction.postBack(session,'checkstats','View Stats'),\\n            builder.CardAction.postBack(session,'checkstats','Track Care Plan'),\\n            builder.CardAction.postBack(session,'call','Call ' + ${response4}.value[i].telephone1) \\n        ]));\\n    }\\n    return patients;\\n    })()\"}],\"stringId\":\"stringId_4527bb0ae7c8f238\"}],\"interrupting\":false,\"breaking\":false,\"returningMessage\":\"\"}"}